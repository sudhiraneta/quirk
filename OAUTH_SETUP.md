# Gmail OAuth Setup Guide for Quirk Extension

## üìã Overview
This guide will help you set up Gmail OAuth authentication for your Quirk extension.

---

## Step 1: Get Your Extension ID

### Option A: From Unpacked Extension (Development)

1. Open Chrome and go to `chrome://extensions/`
2. Enable **Developer mode** (toggle in top-right)
3. Click **Load unpacked** and select your `quirk` folder
4. Your extension will appear with an **ID** like: `abcdefghijklmnopqrstuvwxyz123456`
5. **Copy this ID** - you'll need it for OAuth setup

### Option B: From Packed Extension (Production)

If you want a permanent key for publishing:

```bash
cd /Users/sudhirabadugu/PycharmProjects/quirk
# Pack your extension
# Chrome will generate a .pem file (private key) and .crx file (extension package)
```

Then add the key to `manifest.json` (see below).

---

## Step 2: Create Google Cloud Project & OAuth Credentials

### 2.1 Create a Google Cloud Project

1. Go to [Google Cloud Console](https://console.cloud.google.com/)
2. Click **Select a project** ‚Üí **NEW PROJECT**
3. Name it `Quirk Extension` (or whatever you prefer)
4. Click **CREATE**

### 2.2 Enable Required APIs

1. In your project, go to **APIs & Services** ‚Üí **Library**
2. Search for **"Google+ API"** or **"People API"**
3. Click **ENABLE**

### 2.3 Configure OAuth Consent Screen

1. Go to **APIs & Services** ‚Üí **OAuth consent screen**
2. Select **External** (unless you have a Google Workspace account)
3. Click **CREATE**
4. Fill in required fields:
   - **App name:** Quirk - AI Personality Insights
   - **User support email:** Your email
   - **Developer contact:** Your email
5. Click **SAVE AND CONTINUE**
6. **Scopes:** Click **ADD OR REMOVE SCOPES**
   - Search for `userinfo.email`
   - Select `.../auth/userinfo.email`
   - Click **UPDATE**
7. Click **SAVE AND CONTINUE**
8. **Test users:** Add your Gmail address for testing
9. Click **SAVE AND CONTINUE**

### 2.4 Create OAuth Client ID

1. Go to **APIs & Services** ‚Üí **Credentials**
2. Click **+ CREATE CREDENTIALS** ‚Üí **OAuth client ID**
3. **Application type:** Select **Chrome Extension**
4. **Name:** Quirk Extension
5. **Item ID:** Paste your extension ID from Step 1
6. Click **CREATE**
7. **Copy the Client ID** - it looks like: `123456789-abcdefg.apps.googleusercontent.com`

---

## Step 3: Update manifest.json

Open `quirk/manifest.json` and update these fields:

```json
{
  "oauth2": {
    "client_id": "PASTE_YOUR_CLIENT_ID_HERE.apps.googleusercontent.com",
    "scopes": [
      "https://www.googleapis.com/auth/userinfo.email"
    ]
  },
  "key": "OPTIONAL_EXTENSION_KEY_HERE"
}
```

### About the "key" field:

- **For development:** You can REMOVE the `"key"` line entirely
- **For production/publishing:** You need to add a permanent key

To generate a permanent key:
1. Pack your extension once in Chrome
2. Chrome generates a `.pem` file
3. Convert the `.pem` to base64 and add to manifest
4. OR: Let Chrome Web Store generate it when you publish

**For now, you can remove the `"key"` line for testing!**

---

## Step 4: Test the OAuth Flow

1. **Reload your extension** in `chrome://extensions/`
2. Click the **Quirk** extension icon
3. You should see the **login screen**
4. Click **"Sign in with Google"**
5. OAuth popup should appear
6. Authorize the extension
7. You should be logged in and see your email/profile

---

## Troubleshooting

### Error: "redirect_uri_mismatch"
- Make sure your extension ID in Google Cloud matches the actual extension ID
- The redirect URI should be auto-generated by Chrome

### Error: "Access blocked: This app's request is invalid"
- Make sure you enabled the correct API (Google+ or People API)
- Check that your OAuth consent screen is configured
- Add yourself as a test user if using "External" consent screen

### Error: "invalid_client"
- Double-check your Client ID is correctly pasted in manifest.json
- Make sure there are no extra spaces or quotes

### Login popup doesn't appear
- Check browser console for errors
- Make sure the `identity` permission is in manifest.json
- Try reloading the extension

---

## Backend Update Required

Your backend API needs to handle email-based user lookup:

**Current behavior:** Always creates new UUID
**Required behavior:** Return existing UUID if email exists

Example backend logic (Python/FastAPI):

```python
@router.post("/users/initialize")
async def initialize_user(request: UserInitRequest, db: Session = Depends(get_db)):
    # Check if user with this email exists
    if request.email:
        existing_user = db.query(User).filter(User.email == request.email).first()
        if existing_user:
            return {
                "user_uuid": existing_user.uuid,
                "created_at": existing_user.created_at,
                "existing": True
            }

    # Create new user
    new_user = User(
        uuid=str(uuid.uuid4()),
        email=request.email,
        extension_version=request.extension_version
    )
    db.add(new_user)
    db.commit()

    return {
        "user_uuid": new_user.uuid,
        "created_at": new_user.created_at,
        "existing": False
    }
```

---

## Next Steps

1. ‚úÖ Set up Google Cloud OAuth credentials
2. ‚úÖ Update manifest.json with Client ID
3. ‚ö†Ô∏è Update backend to handle email-based user lookup
4. ‚úÖ Test login flow
5. üöÄ Deploy!

---

## Questions?

If you run into issues:
1. Check the browser console (F12) for errors
2. Check the background service worker console
3. Verify all OAuth settings in Google Cloud Console
